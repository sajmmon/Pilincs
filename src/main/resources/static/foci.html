<!DOCTYPE html>
<html>

<head>
    <title></title>
    <style>
        body, html {
            margin: 0;
        }

    </style>
</head>
<body>
<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<script>
    var w = 800
            , h = 500
            , svg = d3.select('body').append('svg')
                    .attr({width: w, height: h})
            , Force = function (nodes, links) {
                return d3.layout.force()
                        .nodes(nodes)
                        .links(links)
                        .gravity(0)
                        .size([w, h])
                        .linkDistance(0)
                        .linkStrength(0.1)
                        .friction(0.9)
                        .charge(function (d) {
                            return d.charge
                        })
            }
            , Nodes = function (num, id, name) {
                return d3.range(num).map(function () {
                    return {
                        id: id
                        , x: Math.random() * w
                        , y: Math.random() * h
                        , charge: -3
                        , name: name
                    }
                })
            }
            , Foci = function (x, y, name) {
                return {x: x, y: y, charge: 0, fixed: true, name: name}
            }
            , Links = function (nodes, foci) {
                return nodes.map(function (node) {
                    return {source: node, target: foci}
                })
            }
            , fill = function (d) {
                switch (d) {
                    case 0:
                        return 'red';
                        break;
                    case 1:
                        return 'blue';
                        break;
                    case 2:
                        return 'orange';
                        break;
                    case 3:
                        return 'yellow';
                        break;
                    case 4:
                        return 'green';
                        break;
                    case 5:
                        return 'magenta';
                        break;
                    case 6:
                        return 'steelblue';
                        break;
                    case 7:
                        return 'black';
                        break;
                    case 8:
                        return 'brown';
                        break;
                    default:
                        return 'white';
                }
            }
            , affine = function (i, total) {
                var radius = 100;
                var angle = (i / total) * 2 * Math.PI;
                var x = Math.cos(angle);
                var y = Math.sin(angle);
                return {'x': x * radius, 'y': y * radius};
            };

    var groups = 8;
    var links = [];
    var nodes = [];
    var all = [];

    for (var i = 0; i < groups; i++) {
        this['nodes' + i] = Nodes(i * 3 + 10, i, 'node-' + i);
        this['foci' + i] = Foci(w / 2 + affine(i, groups).x, h / 2 + affine(i, groups).y, 'foci-' + i);
    }

    for (var i = 0; i < groups; i++) {
        this['links' + i] = Links(this['nodes' + i], this['foci' + i]);
    }

    for (var i = 0; i < groups; i++) {
        links = links.concat(this['links' + i]);
    }

    for (var i = 0; i < groups; i++) {
        all = all.concat(this['foci' + i]);
    }

    for (var i = 0; i < groups; i++) {
        all = all.concat(this['nodes' + i]);
    }


    var force = Force(all, links);


    force.on('tick', function () {
        svg.selectAll('circle')
                .attr('cx', function (d) {
                    return d.x
                })
                .attr('cy', function (d) {
                    return d.y
                })
    });
    svg.selectAll('circle')
            .data(all)
            .enter().append('circle')
            .attr({
                cx: function (d) {
                    return d.x
                }
                , cy: function (d) {
                    return d.y
                }
                , r: 4
                , 'class': function (d) {
                    return d.name
                }
            }).style({
                'fill': function (d) {
                    return fill(d.id)
                }
                , stroke: 'while'
                , 'stroke-width': 1
            });

    force.start();

    // d3.select('.foci-1').drag()
    for (var i = 0; i < groups; i++) {
        d3.select('.foci-' + i)
                .transition()
                .ease('cubic-in-out')
                .duration(2000)
                .tween('dataTween', function (d) {
                    var ix = d3.interpolate(d.x, w / 2);
                    var iy = d3.interpolate(d.y, h / 2);
                    return function (t) {
                        d.x = d.px = ix(t);
                        d.y = d.py = iy(t)
                    }
                })
    }

</script>
</body>
</html>